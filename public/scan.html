<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="UTF-8">
  <title>Scan</title>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.maskedinput/1.3.1/jquery.maskedinput.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.11.1/jquery.validate.min.js"></script>
  <style type="text/css">
    form { width: 600px; }
    legend { color: blue; }
    label { display: inline-block; width: 10em; text-align: right; padding-right: 5px; }
    input.submit { margin-left: 15em; }
    .error { color: red; }
    span.error { padding-left: 5px; font-size: 90% }
  </style>

<style type="text/css"></style></head>
<body style="" cz-shortcut-listen="true">
  <form action="/scanner/start" method="post" id="scanform" novalidate="novalidate">
    <fieldset>
      <legend>Scan Report Request</legend>
      <p>
        <label for="bussiness_contat">Business Contact:</label>
        <input type="text" id="bussiness_contact_first_name" name="first_name" placeholder="First Name" data-cip-id="bussiness_contact_first_name">
      </p>
      <p>
        <label for="bussiness_contact"></label>
        <input type="text" id="bussiness_contact_last_name" name="last_name" placeholder="Last Name" data-cip-id="bussiness_contact_last_name">
      </p>
      <p>
        <label for="bussiness_name">Business Name:</label>
        <input type="text" id="bussiness_name" name="name" placeholder="Business name" class="action_input_1" data-cip-id="bussiness_name">
      </p>
      <p>
        <label for="bussiness_number">Business Phone:</label>
        <input type="text" id="bussiness_number" name="phone" placeholder="Business telephone number" class="action_input_1" data-cip-id="bussiness_number">
      </p>
      <p>
        <label for="zip">Zip Code:</label>
        <input type="text" id="zip" name="zip" placeholder="Zip" data-cip-id="zip">
      </p>
      <p>
        <label for="email">Email report to:</label>
        <input type="text" id="email" name="email" placeholder="Email" class="action_input_1" data-cip-id="email">
      </p>
      <p>
        <label for"referrer_code"="">Referral Code:</label>
        <input type="text" id="referrer_code" name="referrer_code" placeholder="Referral Code" class="action_input_1" data-cip-id="referrer_code">
      </p>
      <input type="hidden" id="package_id" name="package_id" value="6">
        <input type="submit" class="submit" value="Scan Now">
        <input type="reset" value="Reset">
    </fieldset>
  </form>
  <script type="text/javascript">
<!--//
function showData(data) {
  id = parseInt(Math.random() * data['businesses'].length);
  console.log("Selecting ", id);
  current = data['businesses'][id];
  $('#bussiness_name').val( current['name'] );
  $('#bussiness_number').val( current['phone'] );
  $('#zip').val( current['zip'] );
  console.log(current);
}


function writeScriptTag(path) {
    var fileref = document.createElement('script');
    fileref.setAttribute("type","text/javascript");
    fileref.setAttribute("src", path);

    document.body.appendChild(fileref);
}

function get_yelp_business() {
    writeScriptTag( "https://api.yelp.com/business_review_search?"+
    "term=restaraunts"+
    "&location=92780"+
    "&ywsid=MF0HFrtXBa0YlmAdwDY_3w"+
    "&callback=showData");
}


jQuery(function(){
   $("#bussiness_number").mask("9999999999");
   $("#zip").mask("99999");
   $("#test_button").click(get_yelp_business);
   });

  $("#scanform").validate({
    rules: {
      first_name: "required",
      last_name: "required",
      name: "required",
      phone: "required",
      zip: "required",
      referrer_code: "required",
      email: "email"
      },
      errorElement: "span"
      });

    
    var urlParams;
  (window.onpopstate = function () {
      var match,
          pl = /\+/g, // Regex for replacing addition symbol with a space
          search = /([^&=]+)=?([^&]*)/g,
          decode = function (s) { return decodeURIComponent(s.replace(pl, " ")); },
          query = window.location.search.substring(1);

      urlParams = {};
      while (match = search.exec(query))
         urlParams[decode(match[1])] = decode(match[2]);
      document.getElementById('package_id').value = urlParams['package_id'];
      if (urlParams['package_id'] == "" || urlParams['package_id'] == null) {
        alert("Missing package id, please contact support.");
      }
  })();
//-->
</script>
  

  <button id="test_button">Get Test Business</button>

</body></html>
